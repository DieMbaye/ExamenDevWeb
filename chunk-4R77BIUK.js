import{a as L,b as W}from"./chunk-M2W6QF6I.js";import{a as H}from"./chunk-ADQFG2SS.js";import{a as U}from"./chunk-YPS6JUFR.js";import{a as G}from"./chunk-F2DZTHDP.js";import{a as $,b as B,e as R,k as q}from"./chunk-GZPYKXTC.js";import{l as j}from"./chunk-4AF5SF7N.js";import{i as T,j as z,k as F,l as V}from"./chunk-O4Q2FRRA.js";import{$ as u,$a as l,Da as y,Ia as _,Ta as p,Ua as o,Va as e,Wa as O,Xa as D,_ as m,_a as h,a as P,ab as A,b as w,cb as i,d as x,db as f,eb as v,fb as S,gb as k,hb as I,ib as N,lb as E,nb as M,sa as c,xa as C}from"./chunk-4ZNG45L6.js";function J(a,d){if(a&1){let n=D();o(0,"button",13),h("click",function(){let r=m(n).$implicit,s=l();return u(s.activeTab=r.id)}),i(1),e()}if(a&2){let n=d.$implicit,t=l();A("active",t.activeTab===n.id),c(),v(" ",n.label," ")}}function K(a,d){if(a&1){let n=D();o(0,"div",20)(1,"div",21)(2,"h4"),i(3),e(),o(4,"span",22),i(5),E(6,"date"),e()(),o(7,"div",23)(8,"p")(9,"strong"),i(10,"Motif:"),e(),i(11),e(),o(12,"p")(13,"strong"),i(14,"Date de demande:"),e(),i(15),E(16,"date"),e()(),o(17,"div",24)(18,"button",25),h("click",function(){let r=m(n).$implicit,s=l(2);return u(s.confirmAppointment(r))}),i(19,"Confirmer"),e(),o(20,"button",26),h("click",function(){let r=m(n).$implicit,s=l(2);return u(s.rejectAppointment(r))}),i(21,"Refuser"),e(),o(22,"button",27),h("click",function(){let r=m(n).$implicit,s=l(2);return u(s.showNotesForm(r))}),i(23,"Ajouter des notes"),e()()()}if(a&2){let n=d.$implicit,t=l(2);c(3),f(t.getPatientName(n.patientId)),c(2),S(" ",M(6,5,n.date,"shortDate","fr")," \xE0 ",n.time," "),c(6),v(" ",n.reason),c(4),v(" ",M(16,9,n.createdAt,"short","fr"))}}function Q(a,d){a&1&&(o(0,"div",28)(1,"p"),i(2,"Aucun rendez-vous en attente"),e()())}function X(a,d){if(a&1&&(o(0,"div",14)(1,"div",15)(2,"h2"),i(3,"Rendez-vous en attente de confirmation"),e(),o(4,"span",16),i(5),e()(),o(6,"div",17),_(7,K,24,13,"div",18)(8,Q,3,0,"div",19),e()()),a&2){let n=l();c(5),f(n.pendingAppointments.length),c(2),p("ngForOf",n.pendingAppointments),c(),p("ngIf",n.pendingAppointments.length===0)}}function Y(a,d){if(a&1&&(o(0,"p")(1,"strong"),i(2,"Notes:"),e(),i(3),e()),a&2){let n=l().$implicit;c(3),v(" ",n.notes)}}function Z(a,d){if(a&1){let n=D();o(0,"div",30)(1,"div",21)(2,"h4"),i(3),e(),o(4,"span",22),i(5),E(6,"date"),e()(),o(7,"div",23)(8,"p")(9,"strong"),i(10,"Motif:"),e(),i(11),e(),_(12,Y,4,1,"p",31),e(),o(13,"div",24)(14,"button",32),h("click",function(){let r=m(n).$implicit,s=l(2);return u(s.completeAppointment(r))}),i(15,"Marquer comme termin\xE9"),e(),o(16,"button",27),h("click",function(){let r=m(n).$implicit,s=l(2);return u(s.showNotesForm(r))}),i(17,"Ajouter des notes"),e()()()}if(a&2){let n=d.$implicit,t=l(2);c(3),f(t.getPatientName(n.patientId)),c(2),S(" ",M(6,5,n.date,"shortDate","fr")," \xE0 ",n.time," "),c(6),v(" ",n.reason),c(),p("ngIf",n.notes)}}function tt(a,d){a&1&&(o(0,"div",28)(1,"p"),i(2,"Aucun rendez-vous confirm\xE9"),e()())}function et(a,d){if(a&1&&(o(0,"div",14)(1,"div",15)(2,"h2"),i(3,"Rendez-vous confirm\xE9s"),e(),o(4,"span",16),i(5),e()(),o(6,"div",17),_(7,Z,18,9,"div",29)(8,tt,3,0,"div",19),e()()),a&2){let n=l();c(5),f(n.confirmedAppointments.length),c(2),p("ngForOf",n.confirmedAppointments),c(),p("ngIf",n.confirmedAppointments.length===0)}}function nt(a,d){if(a&1&&(o(0,"p")(1,"strong"),i(2,"Notes:"),e(),i(3),e()),a&2){let n=l().$implicit;c(3),v(" ",n.notes)}}function it(a,d){if(a&1&&(o(0,"div",34)(1,"div",21)(2,"h4"),i(3),e(),o(4,"span",22),i(5),E(6,"date"),e()(),o(7,"div",23)(8,"p")(9,"strong"),i(10,"Motif:"),e(),i(11),e(),_(12,nt,4,1,"p",31),e()()),a&2){let n=d.$implicit,t=l(2);c(3),f(t.getPatientName(n.patientId)),c(2),S(" ",M(6,5,n.date,"shortDate","fr")," \xE0 ",n.time," "),c(6),v(" ",n.reason),c(),p("ngIf",n.notes)}}function ot(a,d){a&1&&(o(0,"div",28)(1,"p"),i(2,"Aucun rendez-vous dans l'historique"),e()())}function at(a,d){if(a&1&&(o(0,"div",14)(1,"div",15)(2,"h2"),i(3,"Historique des rendez-vous"),e(),o(4,"span",16),i(5),e()(),o(6,"div",17),_(7,it,13,9,"div",33)(8,ot,3,0,"div",19),e()()),a&2){let n=l();c(5),f(n.completedAppointments.length),c(2),p("ngForOf",n.completedAppointments),c(),p("ngIf",n.completedAppointments.length===0)}}function rt(a,d){if(a&1){let n=D();o(0,"div",35)(1,"div",36)(2,"h3"),i(3,"Ajouter / Modifier des notes"),e(),o(4,"textarea",37),N("ngModelChange",function(r){m(n);let s=l();return I(s.appointmentNotes,r)||(s.appointmentNotes=r),u(r)}),e(),o(5,"div",38)(6,"button",39),h("click",function(){m(n);let r=l();return u(r.saveNotes())}),i(7,"Sauvegarder"),e(),o(8,"button",40),h("click",function(){m(n);let r=l();return u(r.closeNotesModal())}),i(9,"Annuler"),e()()()()}if(a&2){let n=l();c(4),k("ngModel",n.appointmentNotes)}}var vt=(()=>{let d=class d{constructor(t,r,s,b){this.authService=t,this.appointmentService=r,this.notificationService=s,this.userService=b,this.currentUser=null,this.activeTab="pending",this.tabs=[{id:"pending",label:"En attente"},{id:"confirmed",label:"Confirm\xE9s"},{id:"history",label:"Historique"}],this.appointments=[],this.patients=[],this.selectedPatient=null,this.showNotesModal=!1,this.selectedAppointment=null,this.appointmentNotes="",this.chartOptions={responsive:!0,plugins:{legend:{position:"top"}}},this.appointmentStatusChartData={labels:["En attente","Confirm\xE9s","Termin\xE9s"],datasets:[{data:[0,0,0],backgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]},this.reasonsChartData={labels:[],datasets:[{label:"Nombre de consultations",data:[],backgroundColor:"#42A5F5"}]},this.reasonsChartLabels=[]}ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t&&this.loadDoctorData()})}getCompletedAppointmentsForSelectedPatient(){return this.selectedPatient?this.appointments.filter(t=>t.patientId===this.selectedPatient.uid&&t.status==="completed"):[]}loadDoctorData(){return x(this,null,function*(){if(this.currentUser)try{this.appointments=yield this.appointmentService.getAppointmentsByDoctor(this.currentUser.uid),this.appointments=this.appointments.map(t=>w(P({},t),{date:t.date instanceof Date?t.date:t.date.toDate(),createdAt:t.createdAt instanceof Date?t.createdAt:t.createdAt.toDate()})),this.patients=yield this.userService.getUsersByRole("patient"),this.updateCharts()}catch(t){console.error("Erreur lors du chargement des donn\xE9es:",t)}})}updateCharts(){let t=this.appointments.filter(g=>g.status==="pending").length,r=this.appointments.filter(g=>g.status==="confirmed").length,s=this.appointments.filter(g=>g.status==="completed").length;this.appointmentStatusChartData={labels:["En attente","Confirm\xE9s","Termin\xE9s"],datasets:[{data:[t,r,s],backgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]};let b={};this.appointments.forEach(g=>{g.reason&&(b[g.reason]=(b[g.reason]||0)+1)}),this.reasonsChartLabels=Object.keys(b),this.reasonsChartData={labels:this.reasonsChartLabels,datasets:[{label:"Nombre de consultations",data:Object.values(b),backgroundColor:"#42A5F5"}]}}get todayAppointments(){let t=new Date;return this.appointments.filter(r=>new Date(r.date).toDateString()===t.toDateString()&&(r.status==="confirmed"||r.status==="completed"))}get pendingAppointments(){return this.appointments.filter(t=>t.status==="pending")}get confirmedAppointments(){return this.appointments.filter(t=>t.status==="confirmed")}get completedAppointments(){return this.appointments.filter(t=>t.status==="completed")}confirmAppointment(t){return x(this,null,function*(){if(this.currentUser)try{yield this.appointmentService.updateAppointmentStatus(t.id,"confirmed"),yield this.notificationService.sendConfirmationNotification(t.patientId,this.currentUser.displayName,t.date),yield this.loadDoctorData(),alert("Rendez-vous confirm\xE9 avec succ\xE8s!")}catch(r){console.error("Erreur lors de la confirmation:",r),alert("Erreur lors de la confirmation du rendez-vous")}})}rejectAppointment(t){return x(this,null,function*(){if(confirm("\xCAtes-vous s\xFBr de vouloir refuser ce rendez-vous?"))try{yield this.appointmentService.updateAppointmentStatus(t.id,"cancelled"),yield this.notificationService.createNotification({userId:t.patientId,title:"Rendez-vous refus\xE9",message:`Votre rendez-vous du ${new Date(t.date).toLocaleDateString()} a \xE9t\xE9 refus\xE9`,type:"appointment",read:!1,createdAt:new Date}),yield this.loadDoctorData(),alert("Rendez-vous refus\xE9")}catch(r){console.error("Erreur lors du refus:",r),alert("Erreur lors du refus du rendez-vous")}})}completeAppointment(t){return x(this,null,function*(){if(confirm("Marquer ce rendez-vous comme termin\xE9?"))try{yield this.appointmentService.updateAppointmentStatus(t.id,"completed"),yield this.loadDoctorData(),alert("Rendez-vous marqu\xE9 comme termin\xE9")}catch(r){console.error("Erreur lors de la completion:",r),alert("Erreur lors de la completion du rendez-vous")}})}showNotesForm(t){this.selectedAppointment=t,this.appointmentNotes=t.notes||"",this.showNotesModal=!0}saveNotes(){return x(this,null,function*(){if(this.selectedAppointment)try{this.selectedAppointment.notes=this.appointmentNotes,yield this.appointmentService.addNotesToAppointment(this.selectedAppointment.id,this.appointmentNotes),this.closeNotesModal(),alert("Notes sauvegard\xE9es avec succ\xE8s!"),yield this.loadDoctorData()}catch(t){console.error("Erreur lors de la sauvegarde:",t),alert("Erreur lors de la sauvegarde des notes")}})}closeNotesModal(){this.showNotesModal=!1,this.selectedAppointment=null,this.appointmentNotes=""}getPatientName(t){return this.patients.find(s=>s.uid===t)?.displayName||"Patient"}selectPatient(t){this.selectedPatient=t}};d.\u0275fac=function(r){return new(r||d)(C(j),C(H),C(U),C(G))},d.\u0275cmp=y({type:d,selectors:[["app-doctor-dashboard"]],decls:46,vars:17,consts:[[1,"doctor-dashboard"],[1,"dashboard-header"],[1,"dashboard-stats"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-info"],[1,"dashboard-tabs"],["class","tab-btn",3,"active","click",4,"ngFor","ngForOf"],["class","tab-content",4,"ngIf"],[1,"charts-container"],[1,"chart-card"],["baseChart","",3,"data","labels","type","options"],["class","modal",4,"ngIf"],[1,"tab-btn",3,"click"],[1,"tab-content"],[1,"section-header"],[1,"count-badge"],[1,"appointments-list"],["class","appointment-card pending",4,"ngFor","ngForOf"],["class","no-appointments",4,"ngIf"],[1,"appointment-card","pending"],[1,"appointment-header"],[1,"appointment-date"],[1,"appointment-details"],[1,"appointment-actions"],[1,"confirm-btn",3,"click"],[1,"reject-btn",3,"click"],[1,"notes-btn",3,"click"],[1,"no-appointments"],["class","appointment-card confirmed",4,"ngFor","ngForOf"],[1,"appointment-card","confirmed"],[4,"ngIf"],[1,"complete-btn",3,"click"],["class","appointment-card completed",4,"ngFor","ngForOf"],[1,"appointment-card","completed"],[1,"modal"],[1,"modal-content"],["rows","6","placeholder","Entrez les notes ici...",3,"ngModelChange","ngModel"],[1,"modal-actions"],[1,"save-btn",3,"click"],[1,"cancel-btn",3,"click"]],template:function(r,s){r&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),i(3),e(),o(4,"p"),i(5,"G\xE9rez vos rendez-vous et consultez vos patients"),e()(),o(6,"div",2)(7,"div",3)(8,"div",4),i(9,"\u{1F4C5}"),e(),o(10,"div",5)(11,"h3"),i(12),e(),o(13,"p"),i(14,"Rendez-vous aujourd'hui"),e()()(),o(15,"div",3)(16,"div",4),i(17,"\u23F0"),e(),o(18,"div",5)(19,"h3"),i(20),e(),o(21,"p"),i(22,"En attente de confirmation"),e()()(),o(23,"div",3)(24,"div",4),i(25,"\u2705"),e(),o(26,"div",5)(27,"h3"),i(28),e(),o(29,"p"),i(30,"Confirm\xE9s"),e()()()(),o(31,"div",6),_(32,J,2,3,"button",7),e(),_(33,X,9,3,"div",8)(34,et,9,3,"div",8)(35,at,9,3,"div",8),o(36,"div",9)(37,"div",10)(38,"h3"),i(39,"Statut des rendez-vous"),e(),O(40,"canvas",11),e(),o(41,"div",10)(42,"h3"),i(43,"Motifs de consultation"),e(),O(44,"canvas",11),e()(),_(45,rt,10,1,"div",12),e()),r&2&&(c(3),v("Bienvenue, Dr. ",s.currentUser==null?null:s.currentUser.displayName),c(9),f(s.todayAppointments.length),c(8),f(s.pendingAppointments.length),c(8),f(s.confirmedAppointments.length),c(4),p("ngForOf",s.tabs),c(),p("ngIf",s.activeTab==="pending"),c(),p("ngIf",s.activeTab==="confirmed"),c(),p("ngIf",s.activeTab==="history"),c(5),p("data",s.appointmentStatusChartData)("labels",s.appointmentStatusChartData.labels)("type","pie")("options",s.chartOptions),c(4),p("data",s.reasonsChartData)("labels",s.reasonsChartData.labels)("type","bar")("options",s.chartOptions),c(),p("ngIf",s.showNotesModal))},dependencies:[V,T,z,F,q,$,B,R,W,L],styles:[".doctor-dashboard[_ngcontent-%COMP%]{padding:2rem;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background-color:#f7f9fc;color:#333}.dashboard-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.dashboard-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#666}.dashboard-stats[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center;margin-bottom:2rem}.stat-card[_ngcontent-%COMP%]{background:#fff;padding:1rem 1.5rem;border-radius:12px;box-shadow:0 2px 8px #0000001a;display:flex;align-items:center;gap:1rem;width:250px}.stat-icon[_ngcontent-%COMP%]{font-size:2rem}.stat-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.stat-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#777}.dashboard-tabs[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:2rem}.tab-btn[_ngcontent-%COMP%]{padding:.6rem 1.2rem;margin:0 .3rem;border:none;background-color:#e0e0e0;color:#333;font-weight:500;border-radius:6px;cursor:pointer;transition:background .3s ease}.tab-btn[_ngcontent-%COMP%]:hover{background-color:#d0d0d0}.tab-btn.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:1rem 0}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;margin:0}.count-badge[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:.3rem .6rem;border-radius:20px;font-size:.9rem}.appointments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.appointment-card[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:10px;border-left:6px solid #ccc;box-shadow:0 1px 6px #0000000d}.appointment-card.pending[_ngcontent-%COMP%]{border-color:#ffc107}.appointment-card.confirmed[_ngcontent-%COMP%]{border-color:#28a745}.appointment-card.completed[_ngcontent-%COMP%]{border-color:#6c757d}.appointment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.appointment-date[_ngcontent-%COMP%]{font-size:.95rem;color:#666}.appointment-details[_ngcontent-%COMP%]{margin:.5rem 0}.appointment-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.appointment-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:6px;font-weight:500;cursor:pointer;transition:background .3s ease}.confirm-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}.reject-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.notes-btn[_ngcontent-%COMP%], .complete-btn[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.confirm-btn[_ngcontent-%COMP%]:hover{background-color:#218838}.reject-btn[_ngcontent-%COMP%]:hover{background-color:#c82333}.notes-btn[_ngcontent-%COMP%]:hover, .complete-btn[_ngcontent-%COMP%]:hover{background-color:#0056b3}.no-appointments[_ngcontent-%COMP%]{text-align:center;color:#888;font-style:italic}.charts-container[_ngcontent-%COMP%]{display:flex;gap:2rem;flex-wrap:wrap;justify-content:center;margin-top:3rem}.chart-card[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:10px;box-shadow:0 1px 8px #0000001a;width:400px}.chart-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;margin-bottom:1rem}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;width:90%;max-width:500px}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem}.modal-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;border:1px solid #ccc;border-radius:8px;padding:.5rem;resize:vertical}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem}.save-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}.cancel-btn[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.save-btn[_ngcontent-%COMP%]:hover{background-color:#218838}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#5a6268}"]});let a=d;return a})();export{vt as DoctorDashboardComponent};
